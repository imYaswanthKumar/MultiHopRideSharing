# MultiHopRideSharing (MHRS)


## Step 1: Deciding Multi-Hop Zones:

Run the Jupyter notebook named deciding_multi_hop_zones.ipynb step-by-step.


### Step 1.1.

The inputs are the following:

geohash_path = '.../zones_v2.csv'

trip_path = '.../trips_2016-05_v2.csv'

Replace ... with the folder path in your machine. Following is the information about the above two files:

zones_v2.csv: This file has the geo hash zone information which is created using another piece of code.

trips_2016-05_v2.csv: This file contains the raw data of the New York City Taxi.


The first output generated by this Jupter notebook is:

'.../trips_hop_zones_0721.csv'

### Step 1.2.

The inputs are the following:

hoptrips_path = '.../trips_hop_zones_0721.csv'

trip_path = '../trips_2016-05_v2.csv'

Replace ... with the folder path in your machine. Following is the information about the above two files:

trips_hop_zones_0721.csv

trips_2016-05_v2.csv


The second set of outputs generate by this Jupyter notebook are:

'.../hoptrips_ratio_2_dist_2.csv'

'.../hoptrips_dist_2.csv'

'.../hoptrips_ratio_2_dist_3.csv'

'.../hoptrips_dist_3.csv'



### Step 1.3.

The inputs are the following:

hoptrip_path = '.../hoptrips_ratio_2_dist_2.csv'


Replace ... with the folder path in your machine. The above file is one of the outputs from the previous step.


The third output generated by this Jupter notebook is:

'.../hoptrips_all.csv'


### Step 1.4.

The inputs are the following:

hoptrip_path = '.../hoptrips_all.csv'

graph_path = '.../nyc_network_graph.pkl'


Replace ... with the folder path in your machine. Following is the information about the above two files:

hoptrips_all.csv

nyc_network_graph.pkl


The fourth output generated by this Jupter notebook is:

'.../g2mm.csv'


### Step 1.5.

The inputs are the following:

nyc = '.../taxi_zones.shp'

osm_path = '.../osm_nyc.json'


Replace ... with the folder path in your machine. The above file is one of the outputs from the previous step.

The fifth output generated by this Jupter notebook is:

'.../zones_hop_v1.csv'


### Step 1.6.

The inputs are the following:

geohash_table = '.../zones_hop_v1.csv'

Replace ... with the folder path in your machine.

The sixth output generated by this Jupter notebook is:

'.../hoptrips_all_v2.csv'


### Step 1.7

hoptrip_path = '.../hoptrips_all_v2.csv'

hoptrip_path = '.../hoptrips_all_v3.csv'

geohash_table = '.../zones_hop_v2.csv'


Replace ... with the folder path in your machine.

The sixth output generated by this Jupter notebook is:

'.../hoptrips_all_v3.csv'



## Step 2: Demand Prediction:


Run the Jupyter notebook named demand_prediction_2.ipynb step-by-step.

The inputs are the following:

df = '.../trips_2016-05_v2.csv'

zones = '.../zones_v2.cs'

Replace ... with the folder path in your machine.

The output generated by this Jupter notebook is:

'.../model.h5'

## Step 3: Expected Time to Arrival (ETA) Modeling:

Run the Jupyter notebook named demand_prediction_2.ipynb step-by-step.

The inputs are the following:

data_path = '.../trips_2016-05_v2.csv'

path = '.../triptime_predictor.pkl'

geohash_table = '.../zones.csv'

Replace ... with the folder path in your machine.

The output generated by this Jupter notebook is:

'.../eta.csv'


## Step 4: Training the Deep Q Network (DQN):

After running the Jupyter notebooks discussed in Steps 1-3, you can train the deep Q network simply by executing the following through the command window:

    python -W ignore train_dqn.py

The above Python file requires following inputs:

GRAPH_PATH = '.../nyc_network_graph.pkl'

TRIP_PATH = '.../hoptrips_all_v3.csv'

ETA_MODEL_PATH = '.../triptime_predictor.pkl'

GEOHASH_TABLE_PATH = '.../zones_hop_v2.csv'

SCORE_PATH = '...'

INITIAL_MEMORY_PATH = SCORE_PATH + 'ex_memory_v52.pkl'

Replace ... with the folder path in your machine.

The code has dependencies through the following imports:

from simulator_v2 import FleetSimulator

from dqn_v3 import Agent

from experiment import run, load_trip_chunks, describe
